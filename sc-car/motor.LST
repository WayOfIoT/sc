C51 COMPILER V9.00   MOTOR                                                                 04/14/2017 00:32:41 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MOTOR
OBJECT MODULE PLACED IN motor.OBJ
COMPILER INVOKED BY: D:\SoftwareInstall\dev\keil\C51\BIN\C51.EXE motor.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*-----------------------------------------------
   2            名称：电机驱动函数库
   3            编写：夏杰
   4            日期：2017.4.13
   5            内容：
   6          ------------------------------------------------*/
   7          
   8          #include "sc.h"
   9          
  10          // 电机驱动PWM占空比
  11          uint motor_left_duty = 0, motor_right_duty = 0;
  12          
  13          // 电机PWM波计数器
  14          uint motor_pwm_counter = 0, motor_pwm_t = 100;
  15          
  16          /*-----------------------------------------------
  17            TODO：电机驱动初始化
  18            参数：null
  19            编写：夏杰
  20            日期：2017.4.13
  21          ------------------------------------------------*/
  22          void motor_init()
  23          {
  24   1              // 初始化电机停止
  25   1              motor_left_stop();
  26   1              motor_right_stop();
  27   1      }
  28          
  29          /*-----------------------------------------------
  30            TODO：电机驱动正反转、占空比控制
  31            参数：
  32            编写：夏杰
  33            日期：2017.4.13
  34          ------------------------------------------------*/
  35          void motor_control(MOTOR_DIR motor_left_dir, uint motor_left_duty, MOTOR_DIR motor_right_dir, uint motor_r
             -ight_duty)
  36          {
  37   1              // 电机PWM波周期
  38   1              if(motor_pwm_counter >= motor_pwm_t)
  39   1              {
  40   2                      motor_pwm_counter = 0;
  41   2              }
  42   1              
  43   1              // 左电机驱动
  44   1              switch(motor_left_dir)  
  45   1              {
  46   2                      case motor_left_dir_forward:
  47   2                              motor_left_forward(motor_left_duty);
  48   2                              break;
  49   2                      case motor_left_dir_back:
  50   2                              motor_left_back(motor_left_duty);
  51   2                              break;
  52   2                      case motor_left_dir_stop:
  53   2                              motor_left_stop();
  54   2                              break;
C51 COMPILER V9.00   MOTOR                                                                 04/14/2017 00:32:41 PAGE 2   

  55   2              }
  56   1      
  57   1              // 右电机驱动
  58   1              switch(motor_right_dir)
  59   1              {
  60   2                      // 右电机正转
  61   2                      case motor_right_dir_forward:
  62   2                              motor_right_forward(motor_right_duty);
  63   2                              break;
  64   2                      case motor_right_dir_back:
  65   2                              motor_right_back(motor_right_duty);
  66   2                              break;
  67   2                      case motor_right_dir_stop:
  68   2                              motor_right_stop();
  69   2                              break;
  70   2              }
  71   1      }
  72          
  73          /*-----------------------------------------------
  74            TODO：左电机正转
  75            参数：@motor_duty 电机PWM占空比
  76            编写：夏杰
  77            日期：2017.4.13
  78          ------------------------------------------------*/
  79          void motor_left_forward(uchar motor_duty)
  80          {
  81   1              // 电平驱动左电机正转
  82   1              motor_left_in = MOTOR_ON;
  83   1              motor_left_out = MOTOR_OFF;
  84   1              
  85   1              // PWM波驱动
  86   1              motor_left_duty = motor_duty;
  87   1              if(motor_pwm_counter <= motor_left_duty)
  88   1              {
  89   2                      motor_left_in = MOTOR_ON;
  90   2              }
  91   1              else
  92   1              {
  93   2                      motor_left_in = MOTOR_OFF;
  94   2              }
  95   1              motor_left_out = MOTOR_OFF;
  96   1      }
  97          
  98          /*-----------------------------------------------
  99            TODO：左电机反转
 100            参数：@motor_duty 电机PWM占空比
 101            编写：夏杰
 102            日期：2017.4.13
 103          ------------------------------------------------*/
 104          void motor_left_back(uchar motor_duty)
 105          {
 106   1              motor_left_in = MOTOR_OFF;
 107   1              motor_left_out = MOTOR_ON;
 108   1      
 109   1              // PWM波驱动
 110   1              motor_left_duty = motor_duty;
 111   1              if(motor_pwm_counter <= motor_left_duty)
 112   1              {
 113   2                      motor_left_out = MOTOR_ON;
 114   2              }
 115   1              else
 116   1              {
C51 COMPILER V9.00   MOTOR                                                                 04/14/2017 00:32:41 PAGE 3   

 117   2                      motor_left_out = MOTOR_OFF;
 118   2              }
 119   1              motor_left_in = MOTOR_OFF;
 120   1      }
 121          
 122          /*-----------------------------------------------
 123            TODO：左电机停止
 124            参数：null
 125            编写：夏杰
 126            日期：2017.4.13
 127          ------------------------------------------------*/
 128          void motor_left_stop()
 129          {
 130   1              // 电平驱动
 131   1              motor_left_in = MOTOR_OFF;
 132   1              motor_left_out = MOTOR_OFF;
 133   1      
 134   1              // PWM波占空比驱动
 135   1              motor_left_duty = 0;
 136   1              motor_right_duty = 0;
 137   1      }
 138          
 139          /*-----------------------------------------------
 140            TODO：右电机正转
 141            参数：@motor_duty 电机PWM占空比
 142            编写：夏杰
 143            日期：2017.4.13
 144          ------------------------------------------------*/
 145          void motor_right_forward(uchar motor_duty)
 146          {       
 147   1              motor_right_in = MOTOR_ON;
 148   1              motor_right_out = MOTOR_OFF;
 149   1      
 150   1              // PWM波驱动
 151   1              motor_right_duty = motor_duty;
 152   1              if(motor_pwm_counter <= motor_right_duty)
 153   1              {
 154   2                      motor_right_in = MOTOR_ON;
 155   2              }
 156   1              else
 157   1              {
 158   2                      motor_right_in = MOTOR_OFF;
 159   2              }
 160   1              motor_right_out = MOTOR_OFF;
 161   1      }
 162          
 163          /*-----------------------------------------------
 164            TODO：右电机反转
 165            参数：@motor_duty 电机PWM占空比
 166            编写：夏杰
 167            日期：2017.4.13
 168          ------------------------------------------------*/
 169          void motor_right_back(uchar motor_duty)
 170          {
 171   1              motor_right_in = MOTOR_OFF;
 172   1              motor_right_out = MOTOR_ON;
 173   1      
 174   1              // PWM波驱动
 175   1              motor_right_duty = motor_duty;
 176   1              if(motor_pwm_counter <= motor_right_duty)
 177   1              {
 178   2                      motor_right_out = MOTOR_ON;
C51 COMPILER V9.00   MOTOR                                                                 04/14/2017 00:32:41 PAGE 4   

 179   2              }
 180   1              else
 181   1              {
 182   2                      motor_right_out = MOTOR_OFF;
 183   2              }
 184   1              motor_right_in = MOTOR_OFF;
 185   1      }
 186          
 187          /*-----------------------------------------------
 188            TODO：右电机停止
 189            参数：null
 190            编写：夏杰
 191            日期：2017.4.13
 192          ------------------------------------------------*/
 193          void motor_right_stop()
 194          {
 195   1              motor_right_in = MOTOR_OFF;
 196   1              motor_right_out = MOTOR_OFF;
 197   1      
 198   1              // PWM波占空比驱动
 199   1              motor_left_duty = 0;
 200   1              motor_right_duty = 0;
 201   1      }
 202          
 203          
 204          
 205          
 206          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    227    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8       6
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
