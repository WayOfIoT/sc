C51 COMPILER V9.00   TIMER                                                                 04/14/2017 00:32:41 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE TIMER
OBJECT MODULE PLACED IN timer.OBJ
COMPILER INVOKED BY: D:\SoftwareInstall\dev\keil\C51\BIN\C51.EXE timer.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*-----------------------------------------------
   2            名称：定时器库函数
   3            编写：夏杰
   4            日期：2017.4.10
   5            内容：定时器初始化、中断函数
   6          ------------------------------------------------*/
   7          #include "sc.h"
   8          
   9          /*-----------------------------------------------
  10            TODO：定时器初始化
  11            参数：
  12            编写：夏杰
  13            日期：2017.4.10
  14          ------------------------------------------------*/
  15          void timer_init()
  16          {
  17   1              // 定时器初始化
  18   1              TMOD = 0x01;
  19   1              TH0 = (65535 - timer0_t) / 256; //定时500us,,即0.5ms
  20   1              TL0 = (65535 - timer0_t) % 256;
  21   1      
  22   1              // 使能总中断
  23   1              EA = 1;
  24   1      
  25   1              // 使能内部中断0
  26   1              ET0 = 1;
  27   1              
  28   1              // 启动定时器0(start timer0)
  29   1              TR0 = 1;        
  30   1      }
  31          
  32          /*-----------------------------------------------
  33            TODO：定时器0中断函数
  34            参数：
  35            编写：夏杰
  36            日期：2017.4.10
  37          ------------------------------------------------*/
  38          void timer0() interrupt 1 using 1
  39          {       
  40   1              // pause timer0
  41   1              TR0 = 0;
  42   1      
  43   1              // 定时器重置
  44   1              TH0 = (65535 - timer0_t) / 256; //定时100us,,即0.1ms
  45   1              TL0 = (65535 - timer0_t) % 256;
  46   1      
  47   1              // 电机PWM波计数器
  48   1              motor_pwm_counter++;
  49   1              // 电机控制
  50   1              motor_control(motor_left_dir_forward, 100, motor_right_dir_forward, 100);
  51   1      
  52   1              // 舵机计数器累加
  53   1              steer_pwm_counter++;
  54   1              steer_control(steer_dir_middle);        
  55   1      
C51 COMPILER V9.00   TIMER                                                                 04/14/2017 00:32:41 PAGE 2   

  56   1              // start timer0
  57   1              TR0 = 1;
  58   1      }
  59          
  60          
  61          
  62          
  63          
  64          
  65          
  66          
  67          
  68          
  69          
  70          
  71          
  72          
  73          
  74          
  75          
  76          
  77          
  78          
  79          
  80          
  81          
  82          
  83          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     88    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
