/*-----------------------------------------------
  名称：定时器库函数
  编写：夏杰
  日期：2017.4.10
  内容：定时器初始化、中断函数
------------------------------------------------*/
#include "sc.h"

// 定时器初值设定值
#define timer_time 100
// 定时器计数器，累计定时中断次数
static uint timer_count = 0;

/*-----------------------------------------------
  TODO：定时器初始化
  参数：
  编写：夏杰
  日期：2017.4.10
------------------------------------------------*/
void init_timer0()
{
	// 定时器初始化
	TMOD = 0x01;
	TH0 = (65535 - timer_time) / 256;	//定时500us,,即0.5ms
	TL0 = (65535 - timer_time) % 256;

	// 使能内部中断
	ET0 = 1;
	EA = 1;

	// 启动定时器(start timer0)
	TR0 = 1;	
}

/*-----------------------------------------------
  TODO：定时器0中断函数
  参数：
  编写：夏杰
  日期：2017.4.10
------------------------------------------------*/
void timer0() interrupt 1 using 1
{	
	// pause timer0
	TR0 = 0;

	// 定时器重置
	TH0 = (65535 - timer_time) / 256;	//定时100us,,即0.1ms
	TL0 = (65535 - timer_time) % 256;

	// 高电平控制,,即打舵时间,,打舵角度大小
	timer_count++;	
	
	// 周期设定
	if(timer_count >= 200)
	{
		timer_count = 0;
	}
	
	// 高电平占空
	if(timer_count <= 15)	//PWM控制舵机位置
		steer_out = 1;
	else
		steer_out = 0;

	// start timer0
	TR0 = 1;
}

























